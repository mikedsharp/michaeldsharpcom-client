<!DOCTYPE  html>

<html>
    <head>
        <title>Postmessage madness!</title>
        <script type="text/javascript">
            window.addEventListener("message", receiveMessage, false); 
            var otherWindow; 

            if(window.location.href.indexOf(':8080') > -1){
                otherWindow = window.open('http://localhost:8081'); 
            } else {
                otherWindow = window.parent; 
            }

            function receiveMessage(event){
                var origin = event.origin || event.originalEvent.origin; // For Chrome, the origin property is in the event.originalEvent object.
                if (origin === "http://localhost:8080"){
                    console.log('message received from :8080');
                } else if(origin === "http://localhost:8081"){
                    console.log('message received from :8081');
                }
            }

            function postMsg(){
                if(window.location.href.indexOf(':8080') > -1){
                    otherWindow.postMessage("message from :8080", "http://localhost:8081"); 
                } else {
                    window.opener.postMessage("message from :8081", "http://localhost:8080"); 
                }
            }
        </script>

    </head>
    <body>
        <button type="button" onclick="postMsg()">Click me</button>
        <div id="message-box">
            <ul id="message-list">
                <li class="message">A Message</li>
            </ul>
        </div>
    </body>
</html>